<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>自訂倒數計時器</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@700;900&display=swap');
  body {
    font-family: 'Poppins', 'Noto Sans TC', sans-serif;
    background: #f9fafb;
    margin: 0; padding: 2rem;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
  }
  .timer-container {
    background: white;
    padding: 2rem 2.5rem;
    border-radius: 12px;
    box-shadow: 0 6px 15px rgb(0 0 0 / 0.1);
    max-width: 400px;
    width: 100%;
  }
  h1 {
    font-weight: 900;
    font-size: 1.9rem;
    margin-bottom: 1.5rem;
    color: #222;
    text-align: center;
  }
  label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.3rem;
    color: #555;
  }
  input[type="text"], input[type="number"], select {
    width: 100%;
    padding: 0.45rem 0.6rem;
    border: 1.5px solid #ccc;
    border-radius: 6px;
    margin-bottom: 1rem;
    font-size: 1rem;
    transition: border-color 0.3s ease;
  }
  input[type="text"]:focus, input[type="number"]:focus, select:focus {
    border-color: #007bff;
    outline: none;
  }
  .time-inputs {
    display: flex;
    gap: 0.7rem;
    margin-bottom: 1rem;
  }
  .time-inputs input {
    flex: 1;
  }
  button {
    width: 100%;
    padding: 0.65rem;
    font-size: 1.1rem;
    font-weight: 700;
    border: none;
    border-radius: 8px;
    background: #007bff;
    color: white;
    cursor: pointer;
    transition: background-color 0.25s ease;
  }
  button:hover {
    background: #0056b3;
  }
  .timer-name-display {
    text-align: center;
    font-size: 1.3rem;
    color: #444;
    margin-bottom: 0.8rem;
  }

  /* 全螢幕倒數 */
  .fullscreen-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: #000;
    color: #0ff;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    user-select: none;
  }
  .fullscreen-timer-name {
    font-size: 6vw;
    font-weight: 700;
    margin-bottom: 0.5em;
    text-shadow: 0 0 4px #0ff88;
  }
  .fullscreen-timer-time {
    font-size: 20vw;
    font-weight: 900;
    /* 光暈式柔和陰影 */
    text-shadow:
      0 0 3px #0ff,
      0 0 8px #0ff;
  }
  .hidden {
    display: none !important;
  }
  .alert-flash {
    animation: flash 1s infinite;
    color: red !important;
  }
  @keyframes flash {
    0%, 50%, 100% { opacity: 1; }
    25%, 75% { opacity: 0; }
  }
</style>
</head>
<body>

<div class="timer-container">
  <h1>自訂倒數計時器</h1>
  
  <label for="timerName">計時器名稱</label>
  <input type="text" id="timerName" placeholder="輸入計時器名稱" />
  
  <label>倒數時間</label>
  <div class="time-inputs">
    <input type="number" id="hours" min="0" max="23" placeholder="時" />
    <input type="number" id="minutes" min="0" max="59" placeholder="分" />
    <input type="number" id="seconds" min="0" max="59" placeholder="秒" />
  </div>
  
  <label for="alertTime">提前提醒時間 (秒)</label>
  <select id="alertTime">
    <option value="10">10 秒</option>
    <option value="30" selected>30 秒</option>
    <option value="60">1分鐘</option>
    <option value="120">2分鐘</option>
    <option value="300">5分鐘</option>
    <option value="0">不提醒</option>
  </select>
  
  <label for="alertType">提醒方式</label>
  <select id="alertType">
    <option value="sound" selected>響聲提醒</option>
    <option value="flash">紅字閃爍</option>
    <option value="none">無提醒</option>
  </select>

  <label for="soundSelect">鈴聲選擇（響聲提醒時生效）</label>
  <select id="soundSelect">
    <option value="ding">Ding</option>
    <option value="pop">Pop</option>
    <option value="beep" selected>Beep</option>
    <option value="chime">Chime</option>
    <option value="notify">Notify</option>
    <option value="ping">Ping</option>
  </select>
  
  <button id="startBtn">開始倒數</button>
  
  <div class="timer-name-display" id="displayTimerName"></div>
  <div class="display" id="timeDisplay">00:00:00</div>
</div>

<!-- 全螢幕倒數區 -->
<div id="fullscreenOverlay" class="fullscreen-overlay hidden" tabindex="0">
  <div id="fullscreenTimerName" class="fullscreen-timer-name"></div>
  <div id="fullscreenTimerTime" class="fullscreen-timer-time"></div>
</div>

<!-- 音效 -->
<audio id="ding" src="https://actions.google.com/sounds/v1/alarms/digital_watch_alarm_long.ogg" preload="auto"></audio>
<audio id="pop" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg" preload="auto"></audio>
<audio id="beep" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>
<audio id="chime" src="https://actions.google.com/sounds/v1/alarms/chime_long.ogg" preload="auto"></audio>
<audio id="notify" src="https://actions.google.com/sounds/v1/alarms/medium_bell_ring.ogg" preload="auto"></audio>
<audio id="ping" src="https://actions.google.com/sounds/v1/alarms/ping.ogg" preload="auto"></audio>

<script>
  const startBtn = document.getElementById('startBtn');
  const alertTimeSelect = document.getElementById('alertTime');
  const alertTypeSelect = document.getElementById('alertType');
  const soundSelect = document.getElementById('soundSelect');

  const fullscreenOverlay = document.getElementById('fullscreenOverlay');
  const fullscreenTimerName = document.getElementById('fullscreenTimerName');
  const fullscreenTimerTime = document.getElementById('fullscreenTimerTime');
  const timerContainer = document.querySelector('.timer-container');

  let countdownInterval = null;
  let alerted = false;

  function formatTime(sec) {
    const h = Math.floor(sec / 3600);
    const m = Math.floor((sec % 3600) / 60);
    const s = sec % 60;
    return [
      h.toString().padStart(2,'0'),
      m.toString().padStart(2,'0'),
      s.toString().padStart(2,'0'),
    ].join(':');
  }

 // 播放響聲
function playSoundOneSecond(soundId) {
  const sound = document.getElementById(soundId);
  if (!sound) return;

  let playCount = 0;
  const maxCount = 3; 

  function playNext() {
    if (playCount >= maxCount) return;
    sound.currentTime = 0;
    const playPromise = sound.play();
    if (playPromise !== undefined) {
      playPromise.then(() => {
        playCount++;
        sound.removeEventListener('ended', playNext);
        sound.addEventListener('ended', playNext);
      }).catch((e) => {
        // 播放失敗處理（可忽略）
      });
    }
  }
  playNext();
}


  // 按 ESC 鍵退出全螢幕模式
  fullscreenOverlay.addEventListener('keydown', (e) => {
    if (e.key === "Escape") {
      clearInterval(countdownInterval);
      countdownInterval = null;
      alerted = false;
      fullscreenOverlay.classList.add('hidden');
      timerContainer.classList.remove('hidden');
    }
  });

  startBtn.addEventListener('click', () => {
    if (countdownInterval) {
      clearInterval(countdownInterval);
      countdownInterval = null;
      alerted = false;
    }

    const name = document.getElementById('timerName').value.trim() || '未命名計時器';
    const h = parseInt(document.getElementById('hours').value) || 0;
    const m = parseInt(document.getElementById('minutes').value) || 0;
    const s = parseInt(document.getElementById('seconds').value) || 0;

    let totalSeconds = h * 3600 + m * 60 + s;
    if (totalSeconds <= 0) {
      alert('請輸入有效的倒數時間');
      return;
    }

    const alertSeconds = parseInt(alertTimeSelect.value);
    const alertType = alertTypeSelect.value;
    const soundId = soundSelect.value;

    // 隱藏設定區，顯示全螢幕倒數
    timerContainer.classList.add('hidden');
    fullscreenOverlay.classList.remove('hidden');
    fullscreenOverlay.focus();

    fullscreenTimerName.textContent = name;
    fullscreenTimerTime.textContent = formatTime(totalSeconds);
    fullscreenTimerTime.classList.remove('alert-flash');
    fullscreenTimerTime.style.color = '#0ff';

    alerted = false;

    countdownInterval = setInterval(() => {
      totalSeconds--;
      fullscreenTimerTime.textContent = formatTime(totalSeconds);

      if (!alerted && alertSeconds > 0 && totalSeconds <= alertSeconds && totalSeconds > 0) {
        alerted = true;
        if (alertType === 'sound') {
          playSoundOneSecond(soundId);
        } else if (alertType === 'flash') {
          fullscreenTimerTime.classList.add('alert-flash');
        }
      }

      if (totalSeconds <= 0) {
        clearInterval(countdownInterval);
        countdownInterval = null;
        if (alertType === 'sound') {
          playSoundOneSecond(soundId);
        } else if (alertType === 'flash') {
          fullscreenTimerTime.classList.remove('alert-flash');
          fullscreenTimerTime.style.color = 'red';
        }
      }
    }, 1000);
  });
</script>

</body>
</html>
